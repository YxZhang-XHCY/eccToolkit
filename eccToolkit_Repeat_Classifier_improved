# eccToolkit_Repeat_Classifier_improved_4.py

# eccDNA重复序列分析工具说明

## 功能概述

这是一个用于分析环状染色体外DNA（eccDNA）末端重复序列的Python脚本。该工具可以识别eccDNA断点处的直接重复序列（Direct Repeats）和反向重复序列（Inverted Repeats），这对于理解eccDNA的形成机制至关重要。

主要功能：

- 从输入文件中提取eccDNA区域信息
- 提取每个eccDNA区域两端的序列
- 使用BLAST比对两端序列，寻找直接重复和反向重复
- 根据用户设定的参数筛选有效的重复序列
- 将结果输出为CSV格式

## 工作流程

1. 预处理输入文件，提取eccDNA信息
2. 对每个eccDNA区域：
   - 提取两端的扩展序列（内部和外部都有扩展）
   - 使用BLAST进行序列比对，寻找重复
   - 对重复序列进行筛选，确保它们位于断点附近
3. 合并所有结果并输出到CSV文件

## 依赖项

- bedtools（用于提取序列）
- blastn（用于序列相似性搜索）
- Python依赖：pandas, subprocess等

## 参数说明

- `-i, --input`：输入文件，格式为制表符分隔的四列（名称、染色体、起始位置[0-based]、结束位置[0-based]）
- `-g, --genome`：参考基因组FASTA文件
- `-o, --output`：输出CSV文件名（可选，默认为输入文件名加`_repeat_results.csv`）
- `-t, --threads`：并行处理的线程数
- `--extend_outer`：向eccDNA外部延伸的碱基对数量
- `--extend_inner`：向eccDNA内部延伸的碱基对数量
- `--fai`：基因组FASTA索引文件路径（推荐提供，以确保坐标准确性）
- `--custom_temp_dir`：临时文件存放目录
- `--breakpoint_tolerance`：匹配重复端与eccDNA断点的容差（碱基对）
- `--min_blast_identity`：BLAST比对的最低相似度百分比
- `--min_blast_length`：BLAST比对的最小长度

## 使用示例

```bash
python eccToolkit_Repeat_Classifier_improved_4.py \
  -i U87.tsv \
  -g /data9/home/yxzhang/Genome_Ref/Human/hg38.p13/GRCh38.p13.fna \
  --fai /data9/home/yxzhang/Genome_Ref/Human/hg38.p13/GRCh38.p13.fna.fai \
  -o U87_repeats_refactored.csv \
  -t 16 \
  --extend_outer 150 \
  --extend_inner 50 \
  --custom_temp_dir /data9/home/yxzhang/eccDNA/CNS/Figure/New_Figure2/DR/U87_tmp \
  --breakpoint_tolerance 10 \
  --min_blast_identity 90 \
  --min_blast_length 6 \
  &
```

此命令分析U87.tsv文件中的eccDNA数据，使用hg38参考基因组，将结果输出到U87_repeats_refactored.csv。它使用16个线程进行并行处理，向外扩展150bp，向内扩展50bp，并设置10bp的断点容差。BLAST比对要求至少90%的相似度和最小6bp的匹配长度。临时文件保存在指定目录，`&`符号使进程在后台运行。

## 输出说明

输出CSV文件包含以下主要信息：

- eccDNA的标准名称和原始名称
- eccDNA在基因组上的位置
- 重复类型（直接或反向）
- 重复序列的详细位置和特性
- BLAST比对的统计信息（相似度、长度、E值等）
- 重复序列本身

通过分析这些重复序列，研究人员可以更好地理解eccDNA的形成机制和特性。